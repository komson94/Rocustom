//||=================================================||
//||============= rAthena Script ====================||
//|| Base on: rAthena								 ||
//|| Script by: Fortune-ro							 ||
//|| Script Name: OCP Recycle						 ||
//|| Script Version: 1.0							 ||
//||=================================================||
//||============= Contacts ==========================||
//|| Fortune-ro								 ||
//||=================================================||
//||=================================================||

-	shop	ocp_recycle	-1,909:-1

askald,159,118,4	script	ย่อย OCP	563,{

	mes .NPCName$;
	mes "สวัสดีผู้เล่น ^0000FF"+strcharinfo(0)+"^000000";
	mes "ข้าสามารถย่อยของ OCP ให้เจ้าได้โดย";
	mes "มีโอกาสสำเร็จ: ^FF0000"+.SuccessPercent+"^000000%";
	mes "เมื่อสำเร็จจะสุ่มได้ ^FF0000"+.MinCashGive+"-"+.MaxCashGive+"^000000 OCP Coin";
	mes "^FF0000ต่อ OCP 1 ชิ้น^000000";
	mes "เจ้าสนใจจะย่อยหน่อยไหมละ?";
	next;
	menu "~ ข้ามาเพื่อย่อย OCP",-,"~ ยกเลิก",Cancel;
	
	deletearray @sold_nameid[0],getarraysize(@sold_nameid);
	callshop "ocp_recycle",2;
	npcshopattach "ocp_recycle";
	end;
	
Cancel:
	mes .NPCName$;
	mes " ";
	mes "^FF0000ไม่เป็นไร!! ถ้ารู้สึกว่ามันรกเมื่อไหร่ค่อยกลับมาหาข้า^000000";
	close;
	
OnSellItem:
	mes .NPCName$;
	mes "OCP ที่เจ้าจะย่อย";
	mes "-----------------------------------";
	freeloop(1);
	for ( set .@i,0; .@i<getarraysize(@sold_nameid); set .@i,.@i+1 )
		for ( set .@a,0; .@a<getarraysize(.OCPAccessID); set .@a,.@a+1 )
			if ( @sold_nameid[.@i] == .OCPAccessID[.@a] ) {
				set .@Item_id[getarraysize(.@Item_id)], @sold_nameid[.@i];
				set .@Item_amt[getarraysize(.@Item_amt)], @sold_quantity[.@i];
				set .@item, @sold_nameid[.@i];
				mes ((.@item)?"  ^FF0000":"  ^777777")+@sold_quantity[.@i]+"x "+getitemname(@sold_nameid[.@i])+"^000000";
				set .@Item_total, .@Item_total+@sold_quantity[.@i];
			}
	freeloop(0);
	deletearray @sold_nameid[0], getarraysize(@sold_nameid);
	deletearray @sold_quantity[0], getarraysize(@sold_quantity);
	
	if ( !.@Item_id ) {
		mes "  ^FF0000ไอเทมนี้ไม่สามารถย่อยได้^000000";
		mes "  ^FF0000เหตุผลที่ไม่สามารถย่อยได้อาจเป็นดังนี้^000000";
		mes "  ^FF00001.ไม่ใช่ไอเทมที่ NPC ต้องการ^000000";
		mes "  ^FF00002.เป็นไอเทมที่่ดรอปมาจาก Monster^000000";
		mes "  ^FF00003.เป็นไอเทมที่ได้รับจากเควส^000000";
		mes "-----------------------------------";
		close;
	}
	
	mes " ";
	mes "-----------------------------------";
	next;
	
	if ( select(" ~ ^0055FFยืนยันการย่อย^000000: ~ ^777777ยกเลิก^000000") == 2 ) {
		mes .NPCName$;
		mes " ";
		mes "^FF0000โอเคไม่เป็นไร!!^000000";
		close;
	}
	
	for ( set .@i,0; .@i<getarraysize(.@Item_id); set .@i,.@i+1 )
	delitem .@Item_id[.@i],.@Item_amt[.@i];
	specialeffect2 10;
	
	mes .NPCName$;
	mes " ";
	for ( set .@i,0; .@i<getarraysize(.@Item_id); set .@i,.@i+1 ) {
		mes "ไอเทมชิ้นที่ "+(.@i+1)+":";
		if ( rand(1,100) > .SuccessPercent ) {
			mes "^FF0000"+getitemname(.@Item_id[.@i])+" : ย่อยไม่สำเร็จ^000000";
			mes "======================";
		} else {
			mes "^0000FF"+getitemname(.@Item_id[.@i])+" : ย่อยสำเร็จ";
			set .@successcount, .@successcount + 1;
			set .@randcash, rand(.MinCashGive,.MaxCashGive);
			set .@SuccessItemID[getarraysize(.@SuccessItemID)], .@Item_id[.@i];
			set .@SuccessCash[getarraysize(.@SuccessCash)], .@randcash;
			mes "และได้รับ : "+.@randcash+" OCP Coin^000000";
			mes "=======================";
			set .@randcash, 0;	
		}
	}
	
	next;
	
	if ( .@successcount < 1 ) {
		mes .NPCName$;
		mes " ";
		mes "^FF0000การย่อยของเจ้าไม่สำเร็จซักชิ้นเลย^000000";
		close;
	}
	
	mes .NPCName$;
	mes "รวมย่อยสำเร็จ";
	for ( set .@i,0; .@i<getarraysize(.@SuccessItemID); set .@i,.@i+1 ) {
		mes ""+getitemname(.@SuccessItemID[.@i])+" : "+.@SuccessCash[.@i]+" OCP Coin";
		set .@TotalCash, .@TotalCash + .@SuccessCash[.@i];
	}
	mes "ทั้งหมด : "+.@TotalCash+" OCP Coin";
	getitem .CCItemID, .@TotalCash;
	close;

OnInit:
	set .NPCName$, "[ ย่อย OCP ]";		// ตั้งค่าชื่อ NPC
	waitingroom "  OCP Recycle",0;		// ตั้งค่าป้ายบนหัว NPC
	// ตั้งค่ากำหนดรหัสไอเทม OCP
	setarray .OCPAccessID,
	/*18849,*/ 19140, 19296, 18793, 19163, 18795, 5897, 5898, 19308, 5464,
	19409, 5899, 19342, 19079, 19343, 19125, 19329, 5968, 5900, 19157,
	18522, 19387, 19081, 5901, 5937, 19272, 19021, 19269, 18563, 5497,
	19156, 5905, 19171, 18933, 5906, 18794, 19102, 18908, 15165, 5969,
	19116, 5208, 19337, 19469, 5907, 19172, 18791, 19285, 40138, 19426,
	19114, 19379, 19020, 18652, 5904, 18856, 5963, 18656, 19407, 5975,
	19249, 19082, 18603, 19245, 5933, 5924, 18507, 5916, 19391, 19380,
	5918, 19273, 2204, 18676, 18823, 5966, 18937, 5985, 19437, 18720,
	18591, 5921, 18799, 18813, 19024, 19138, 19085, 2202, 18609, 19117,
	18787, 5475, 40210, 40114, 18666, 5972, 19438, 19173, 5967, 18536,
	
	19101, 19095, 19306, 28502, 19274, 19381, 40141, 19327, 40147, 40112,
	19137, 19139, 19112, 5978, 19299, 5945, 19246, 15166, 15420, 15204,
	15352, 15144, 15249, /*15147, 15146, 15164,*/ 15087, 15409, 18862, 15176,
	15135, 15130, 15209, 15106, 15145, /*15128,*/ 15405, 15125, 15175, 15205,
	15124, 15102, 15191, 15169, 15103, 15283, 15419, 15112, 15140, 15072,
	15142, 15417, 15384, 15139, 15071, 15108, 15143, /*2345, 2347, 2349,*/
	/*2351,*/ 15060, 15189, 15186, 15178, /*28721,*/ 21019, /*18145,*/ 28618, 13470,
	13471, 13472, 32007, 1449, 1835, 16051, 28717, 1494, 16043, 1993,
	28602, /*13332,*/ 13460, 13461, 13462, /*1935,*/ 1940, 1990, 26152, 1682,
	1833, 1447, /*28014, 28712, 28713,*/ 40168, 40169, 28921, 28901, 28902,
	
	28941, 28955, 28916, 28929, 2168, /*2153,*/ 2198, 28951, 2192, /*28900,*/
	28903, 28918, 2191, 2196, 28913, 460003, 28942, 480084, 2576, 20831,
	20714, 20860, 20813, 20925, 20799, 20800, 20797, /*20773,*/ 2589, 20724,
	20726, 20783, 20949, 20922, 20942, 20845, 20863, 20932, 20859, 20941,
	20931, 20778, 2596, 20837, 20836, 20846, 20962, 20712, 20969, 20814,
	20728, 20815, 2584, 20821, /*2554,*/ 20940, 20986, 20816, 20707, /*22171,*/
	22214, 22211, 40108, 22138, 22134, /*22103,*/ 22210, 22106, 22172, 22207,
	22051, 22101, 22189, 22104, 22055, 22120, 22203, 22170, 22042, 22145,
	22198, 40230, 22039, 22195, 470006, /*22238,*/ 28430, 28429, 28320, 28531,
	28513, 28533, 28441, 28520, 28411, 28573, /*2980,*/ 28438, 28386, 28434,
	
	28521, 32222, 28437, 28501, 32227, 32204, 40259, 490038, 28491, 28551,
	28372, 28503, 28394, 28433, 28377, 28507, 32242, 28565, 28598, 32206,
	32262, 28484, 2936, 2984, 28410, 28379, 2998, 28485, 32264, 490037,
	28594, 32263, 28492, 28564, 28575, 28352, 28353, 28357, 28359, 28560,
	28500, 32203, 2737, 2935, 28506, 490031, 32258, 490079, 490098, 490102,
	19268, 490096, 490068, 490104, 490105, 35447, 490083, 22103, 22171, 
	18818, 5362, 20773, 2539, 18894, 420045, 410025, 28552, 490118,
	490113, 490130, 490013, 490029, 490110, 19495, 410057, 420006, 19499,
	19453, 15892, 400077, 19497, 20991, 20857, 32265, 450176, 22243, 470084,
	470008, 470025, 470027, 470030, 470034, 470058, 470062, 470078, 470080,
	470082, 470089, 470091, 470033, 470036, 470056, 470061, 480023, 480064,
	480085, 480094, 480081, 450180;
	
	set .CCItemID, 1100010;			// ตั้งค่ารหัสไอเทมเหรียญ CC
	set .SuccessPercent, 60;		// ตั้งค่า % ย่อยสำเร็จ
	set .MinCashGive, 1;			// ตั้งค่าค่าต่ำสุดของ CC ที่จะได้รับ
	set .MaxCashGive, 10;			// ตั้งค่าค่าสูงสุดของ CC ที่จะได้รับ
	end;
}